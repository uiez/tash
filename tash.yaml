templates:
  build:
    - condition:
        value: $GOOS
        compare: windows
        actions:
          - env:
              value: EXECUTABLE_EXT=.exe
    - cmd:
        exec: go build -ldflags "-w -s" -o tash_${GOOS}_${GOARCH | string.default amd64}$EXECUTABLE_EXT

tasks:
  darwin_amd64:
    description: |-
      build darwin binary
    actions:
      - env:
          value: GOOS=darwin
      - template: build

  linux_amd64:
    description: |-
      build linux binary
    actions:
      - env:
          value: GOOS=linux
      - template: build

  windows_amd64:
    description: |-
      build windows 64bit binary
    actions:
      - env:
          value: GOOS=windows
      - template: build

  windows_386:
    description: |-
      build windows 32bit binary
    actions:
      - env:
          value: GOOS=windows; GOARCH=386
      - template: build

  all:
    depends: [darwin_amd64, linux_amd64, windows_amd64, windows_386]
